# Migration `20201006200931-change-from-sequence-to-uuid`

This migration has been generated by Adriana Olszak at 10/6/2020, 10:09:31 PM.
You can check out the [state of the schema](./schema.prisma) after the migration.

## Database Steps

```sql
CREATE TYPE "AccessRight" AS ENUM ('STUDENT', 'MENTOR')

CREATE TYPE "ProficiencyLevel" AS ENUM ('BEGINNER', 'INTERMEDIATE', 'PROFICIENT', 'EXPERT')

CREATE TABLE "public"."Profile" (
"id" text   NOT NULL ,
"bio" jsonb   ,
"userId" text   NOT NULL ,
PRIMARY KEY ("id")
)

CREATE TABLE "public"."User" (
"id" text   NOT NULL ,
"createdAt" timestamp(3)   NOT NULL DEFAULT CURRENT_TIMESTAMP,
"updatedAt" timestamp(3)   NOT NULL ,
"email" text   NOT NULL ,
"password" text   NOT NULL ,
"name" text   NOT NULL ,
"surname" text   NOT NULL ,
"isDeleted" boolean   NOT NULL DEFAULT false,
"accessToken" text   ,
"refreshToken" text   ,
"lastLogin" timestamp(3)   ,
"isEmailVerified" boolean   NOT NULL DEFAULT false,
"access" "AccessRight"  NOT NULL ,
PRIMARY KEY ("id")
)

CREATE TABLE "public"."UserOnLanguageOnProficiency" (
"id" text   NOT NULL ,
"languageId" text   NOT NULL ,
"proficiencyId" text   NOT NULL ,
"userId" text   NOT NULL ,
PRIMARY KEY ("id")
)

CREATE TABLE "public"."Proficiency" (
"id" text   NOT NULL ,
"name" "ProficiencyLevel"  NOT NULL ,
PRIMARY KEY ("id")
)

CREATE TABLE "public"."Language" (
"id" text   NOT NULL ,
"code" text   NOT NULL ,
PRIMARY KEY ("id")
)

CREATE UNIQUE INDEX "Profile.userId_unique" ON "public"."Profile"("userId")

CREATE UNIQUE INDEX "User.email_unique" ON "public"."User"("email")

CREATE INDEX "User.email_index" ON "public"."User"("email")

CREATE INDEX "Proficiency.name_index" ON "public"."Proficiency"("name")

CREATE INDEX "Language.code_index" ON "public"."Language"("code")

ALTER TABLE "public"."Profile" ADD FOREIGN KEY ("userId")REFERENCES "public"."User"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "public"."UserOnLanguageOnProficiency" ADD FOREIGN KEY ("languageId")REFERENCES "public"."Language"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "public"."UserOnLanguageOnProficiency" ADD FOREIGN KEY ("proficiencyId")REFERENCES "public"."Proficiency"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "public"."UserOnLanguageOnProficiency" ADD FOREIGN KEY ("userId")REFERENCES "public"."User"("id") ON DELETE CASCADE ON UPDATE CASCADE
```

## Changes

```diff
diff --git schema.prisma schema.prisma
migration 20201004090646-added-token-fields-to-user..20201006200931-change-from-sequence-to-uuid
--- datamodel.dml
+++ datamodel.dml
@@ -2,9 +2,9 @@
 // learn more about it in the docs: https://pris.ly/d/prisma-schema
 datasource db {
   provider = "postgresql"
-  url = "***"
+  url = "***"
   password = env("DATABASE_PASS")
   user     = "postgres"
 }
@@ -12,27 +12,27 @@
   provider = "prisma-client-js"
 }
 model Profile {
-  id      Int     @default(autoincrement()) @id
+  id      String      @default(uuid()) @id
   bio     Json?
-  user    User    @relation(fields: [userId], references: [id])
-  userId  Int     @unique
+  user    User        @relation(fields: [userId], references: [id])
+  userId  String      @unique
 }
 model User {
-  id                Int      @default(autoincrement()) @id
-  createdAt         DateTime @default(now())
-  updatedAt         DateTime @updatedAt
-  email             String   @unique
+  id                String      @default(uuid()) @id
+  createdAt         DateTime    @default(now())
+  updatedAt         DateTime    @updatedAt
+  email             String      @unique
   password          String
   name              String
   surname           String
-  isDeleted         Boolean   @default(false)
+  isDeleted         Boolean     @default(false)
   accessToken       String?
   refreshToken      String?
   lastLogin         DateTime?
-  isEmailVerified   Boolean   @default(false)
+  isEmailVerified   Boolean     @default(false)
   access            AccessRight
   languages         UserOnLanguageOnProficiency[]
   profile           Profile?
@@ -43,19 +43,19 @@
   STUDENT
   MENTOR
 }
 model UserOnLanguageOnProficiency {
-  id              Int         @default(autoincrement()) @id
+  id              String      @default(uuid()) @id
   language        Language    @relation(fields: [languageId], references: [id])
-  languageId      Int
+  languageId      String
   proficiency     Proficiency @relation(fields: [proficiencyId], references: [id])
-  proficiencyId   Int
+  proficiencyId   String
   user            User        @relation(fields: [userId], references: [id])
-  userId          Int
+  userId          String
 }
 model Proficiency {
-  id      Int @default(autoincrement()) @id
+  id      String              @default(uuid()) @id
   name    ProficiencyLevel
   @@index([name])
 }
@@ -67,9 +67,9 @@
   EXPERT
 }
 model Language {
-  id      Int @default(autoincrement()) @id
+  id      String      @default(uuid()) @id
   code    String
   @@index([code])
 }
```


