# Migration `20201011104407-create-mentor-student-and-related-schemas`

This migration has been generated by Katarzyna Marciniszyn at 10/11/2020, 12:44:08 PM.
You can check out the [state of the schema](./schema.prisma) after the migration.

## Database Steps

```sql
CREATE TYPE "public"."AccessRight" AS ENUM ('STUDENT', 'MENTOR')

CREATE TYPE "public"."ProficiencyLevel" AS ENUM ('SLUG_BEGINNER', 'SLUG_INTERMEDIATE', 'SLUG_PROFICIENT', 'SLUG_EXPERT')

CREATE TABLE "public"."Profile" (
"id" text   NOT NULL ,
"bio" jsonb   ,
"userId" text   NOT NULL ,
PRIMARY KEY ("id")
)

CREATE TABLE "public"."Mentor" (
"id" text   NOT NULL ,
"createdAt" timestamp(3)   NOT NULL DEFAULT CURRENT_TIMESTAMP,
"updatedAt" timestamp(3)   NOT NULL ,
"userId" text   NOT NULL ,
PRIMARY KEY ("id")
)

CREATE TABLE "public"."Student" (
"id" text   NOT NULL ,
"createdAt" timestamp(3)   NOT NULL DEFAULT CURRENT_TIMESTAMP,
"updatedAt" timestamp(3)   NOT NULL ,
"userId" text   NOT NULL ,
PRIMARY KEY ("id")
)

CREATE TABLE "public"."TimeSlot" (
"id" text   NOT NULL ,
"createdAt" timestamp(3)   NOT NULL DEFAULT CURRENT_TIMESTAMP,
"updatedAt" timestamp(3)   NOT NULL ,
"mentorId" text   NOT NULL ,
"start" timestamp(3)   NOT NULL ,
"end" timestamp(3)   NOT NULL ,
"lessonId" text   NOT NULL ,
PRIMARY KEY ("id")
)

CREATE TABLE "public"."ScheduledLesson" (
"id" text   NOT NULL ,
"createdAt" timestamp(3)   NOT NULL DEFAULT CURRENT_TIMESTAMP,
"updatedAt" timestamp(3)   NOT NULL ,
"mentorId" text   NOT NULL ,
"studentId" text   NOT NULL ,
PRIMARY KEY ("id")
)

CREATE TABLE "public"."Offer" (
"id" text   NOT NULL ,
"createdAt" timestamp(3)   NOT NULL DEFAULT CURRENT_TIMESTAMP,
"updatedAt" timestamp(3)   NOT NULL ,
"mentorId" text   NOT NULL ,
"timeSlotsCount" integer   NOT NULL ,
"price" integer   NOT NULL ,
PRIMARY KEY ("id")
)

CREATE TABLE "public"."User" (
"id" text   NOT NULL ,
"createdAt" timestamp(3)   NOT NULL DEFAULT CURRENT_TIMESTAMP,
"updatedAt" timestamp(3)   NOT NULL ,
"email" text   NOT NULL ,
"password" text   NOT NULL ,
"name" text   NOT NULL ,
"surname" text   NOT NULL ,
"isDeleted" boolean   NOT NULL DEFAULT false,
"accessToken" text   ,
"refreshToken" text   ,
"lastLogin" timestamp(3)   ,
"isEmailVerified" boolean   NOT NULL DEFAULT false,
"access" "AccessRight"  NOT NULL ,
PRIMARY KEY ("id")
)

CREATE TABLE "public"."UserOnLanguageOnProficiency" (
"id" text   NOT NULL ,
"languageId" text   NOT NULL ,
"proficiencyId" text   NOT NULL ,
"userId" text   NOT NULL ,
PRIMARY KEY ("id")
)

CREATE TABLE "public"."Proficiency" (
"id" text   NOT NULL ,
"name" "ProficiencyLevel"  NOT NULL ,
PRIMARY KEY ("id")
)

CREATE TABLE "public"."Language" (
"id" text   NOT NULL ,
"code" text   NOT NULL ,
PRIMARY KEY ("id")
)

CREATE UNIQUE INDEX "Profile.userId_unique" ON "public"."Profile"("userId")

CREATE UNIQUE INDEX "Mentor.userId_unique" ON "public"."Mentor"("userId")

CREATE UNIQUE INDEX "Student.userId_unique" ON "public"."Student"("userId")

CREATE UNIQUE INDEX "ScheduledLesson.mentorId_unique" ON "public"."ScheduledLesson"("mentorId")

CREATE UNIQUE INDEX "ScheduledLesson.studentId_unique" ON "public"."ScheduledLesson"("studentId")

CREATE UNIQUE INDEX "Offer.mentorId_unique" ON "public"."Offer"("mentorId")

CREATE UNIQUE INDEX "User.email_unique" ON "public"."User"("email")

CREATE INDEX "User.email_index" ON "public"."User"("email")

CREATE INDEX "Proficiency.name_index" ON "public"."Proficiency"("name")

CREATE INDEX "Language.code_index" ON "public"."Language"("code")

ALTER TABLE "public"."Profile" ADD FOREIGN KEY ("userId")REFERENCES "public"."User"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "public"."Mentor" ADD FOREIGN KEY ("userId")REFERENCES "public"."User"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "public"."Student" ADD FOREIGN KEY ("userId")REFERENCES "public"."User"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "public"."TimeSlot" ADD FOREIGN KEY ("mentorId")REFERENCES "public"."Mentor"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "public"."TimeSlot" ADD FOREIGN KEY ("lessonId")REFERENCES "public"."ScheduledLesson"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "public"."ScheduledLesson" ADD FOREIGN KEY ("mentorId")REFERENCES "public"."Mentor"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "public"."ScheduledLesson" ADD FOREIGN KEY ("studentId")REFERENCES "public"."Student"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "public"."Offer" ADD FOREIGN KEY ("mentorId")REFERENCES "public"."Mentor"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "public"."UserOnLanguageOnProficiency" ADD FOREIGN KEY ("languageId")REFERENCES "public"."Language"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "public"."UserOnLanguageOnProficiency" ADD FOREIGN KEY ("proficiencyId")REFERENCES "public"."Proficiency"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "public"."UserOnLanguageOnProficiency" ADD FOREIGN KEY ("userId")REFERENCES "public"."User"("id") ON DELETE CASCADE ON UPDATE CASCADE
```

## Changes

```diff
diff --git schema.prisma schema.prisma
migration 20201006200931-change-from-sequence-to-uuid..20201011104407-create-mentor-student-and-related-schemas
--- datamodel.dml
+++ datamodel.dml
@@ -2,9 +2,9 @@
 // learn more about it in the docs: https://pris.ly/d/prisma-schema
 datasource db {
   provider = "postgresql"
-  url = "***"
+  url = "***"
   password = env("DATABASE_PASS")
   user     = "postgres"
 }
@@ -18,8 +18,61 @@
   user    User        @relation(fields: [userId], references: [id])
   userId  String      @unique
 }
+model Mentor {
+  id                 String            @default(uuid()) @id
+  createdAt          DateTime          @default(now())
+  updatedAt          DateTime          @updatedAt
+  user               User              @relation(fields: [userId], references: [id])
+  userId             String            @unique
+  timeSlots          TimeSlot[]
+  scheduledLessons   ScheduledLesson[]
+  offers             Offer[]
+}
+
+model Student {
+  id                 String             @default(uuid()) @id
+  createdAt          DateTime           @default(now())
+  updatedAt          DateTime           @updatedAt
+  user               User               @relation(fields: [userId], references: [id])
+  userId             String             @unique
+  scheduledLessons   ScheduledLesson[]
+}
+
+model TimeSlot {
+  id                 String               @default(uuid()) @id
+  createdAt          DateTime             @default(now())
+  updatedAt          DateTime             @updatedAt
+  mentor             Mentor               @relation(fields: [mentorId], references: [id])
+  mentorId           String
+  start              DateTime
+  end                DateTime
+  scheduledLesson    ScheduledLesson      @relation(fields: [lessonId], references: [id])
+  lessonId           String
+}
+
+model ScheduledLesson {
+  id         String      @default(uuid()) @id
+  createdAt  DateTime    @default(now())
+  updatedAt  DateTime    @updatedAt
+  timeSlots  TimeSlot[]
+  mentorId   String      @unique
+  mentor     Mentor      @relation(fields: [mentorId], references: [id])
+  studentId  String      @unique
+  student    Student     @relation(fields: [studentId], references: [id])
+}
+
+model Offer {
+  id              String      @default(uuid()) @id
+  createdAt       DateTime    @default(now())
+  updatedAt       DateTime    @updatedAt
+  mentorId        String      @unique
+  mentor          Mentor      @relation(fields: [mentorId], references: [id])
+  timeSlotsCount  Int
+  price           Int
+}
+
 model User {
   id                String      @default(uuid()) @id
   createdAt         DateTime    @default(now())
   updatedAt         DateTime    @updatedAt
@@ -34,8 +87,10 @@
   isEmailVerified   Boolean     @default(false)
   access            AccessRight
   languages         UserOnLanguageOnProficiency[]
   profile           Profile?
+  mentor            Mentor?
+  student           Student?
   @@index([email])
 }
@@ -60,12 +115,12 @@
   @@index([name])
 }
 enum ProficiencyLevel {
-  BEGINNER
-  INTERMEDIATE
-  PROFICIENT
-  EXPERT
+  SLUG_BEGINNER
+  SLUG_INTERMEDIATE
+  SLUG_PROFICIENT
+  SLUG_EXPERT
 }
 model Language {
   id      String      @default(uuid()) @id
```


